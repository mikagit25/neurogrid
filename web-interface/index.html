<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroGrid - Distributed AI Inference Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'neurogrid': {
                            50: '#f0f9ff',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            900: '#1e3a8a'
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-subtle': 'bounceSubtle 2s infinite'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        bounceSubtle: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <div class="w-8 h-8 bg-neurogrid-600 rounded-lg flex items-center justify-center">
                            <span class="text-white font-bold text-sm">NG</span>
                        </div>
                        <span class="ml-3 text-xl font-semibold text-gray-900">NeuroGrid</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#tasks" class="border-neurogrid-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Tasks
                        </a>
                        <a href="node-monitoring.html" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            My Nodes
                        </a>
                        <a href="#analytics" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Analytics
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- User menu or login -->
                    <div id="userSection">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                    <button onclick="showTaskSubmission()" class="bg-neurogrid-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-neurogrid-700 transition-all duration-200 transform hover:scale-105 hover:shadow-lg">
                        <i class="fas fa-plus mr-2"></i>Submit Task
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-neurogrid-600 to-neurogrid-700">
        <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl font-extrabold text-white sm:text-5xl md:text-6xl">
                    <span class="block">Distributed AI</span>
                    <span class="block text-neurogrid-200">Inference Platform</span>
                </h1>
                <p class="mt-3 max-w-md mx-auto text-base text-neurogrid-200 sm:text-lg md:mt-5 md:text-xl md:max-w-3xl">
                    Harness idle compute power worldwide to democratize access to artificial intelligence. 
                    Run AI models efficiently and affordably on our decentralized network.
                </p>
                <div class="mt-5 max-w-md mx-auto sm:flex sm:justify-center md:mt-8">
                    <div class="rounded-md shadow animate-bounce-subtle">
                        <button onclick="showTaskSubmission()" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-neurogrid-700 bg-white hover:bg-gray-50 transition-all duration-300 transform hover:scale-105 hover:shadow-xl md:py-4 md:text-lg md:px-10">
                            Submit Your First Task
                        </button>
                    </div>
                    <div class="mt-3 rounded-md shadow sm:mt-0 sm:ml-3">
                        <a href="node-setup.html" class="w-full flex items-center justify-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-neurogrid-500 hover:bg-neurogrid-600 transition-all duration-300 transform hover:scale-105 hover:shadow-xl md:py-4 md:text-lg md:px-10">
                            <i class="fas fa-download mr-2"></i>Setup Node
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="bg-white">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:py-16 sm:px-6 lg:px-8 lg:py-20">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">
                    Network Statistics
                </h2>
                <p class="mt-3 text-xl text-gray-500 sm:mt-4">
                    Real-time statistics from the NeuroGrid network
                </p>
            </div>
            <dl class="mt-10 text-center sm:max-w-3xl sm:mx-auto sm:grid sm:grid-cols-3 sm:gap-8">
                <div class="flex flex-col transform transition-all duration-300 hover:scale-105">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Active Nodes</dt>
                    <dd class="order-1 text-5xl font-extrabold text-neurogrid-600 animate-pulse-slow" id="active-nodes">
                        <span class="loading-spinner hidden">⟳</span>
                        <span class="stat-value">-</span>
                    </dd>
                </div>
                <div class="flex flex-col mt-10 sm:mt-0 transform transition-all duration-300 hover:scale-105">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Tasks Completed</dt>
                    <dd class="order-1 text-5xl font-extrabold text-neurogrid-600 animate-pulse-slow" id="tasks-completed">
                        <span class="loading-spinner hidden">⟳</span>
                        <span class="stat-value">-</span>
                    </dd>
                </div>
                <div class="flex flex-col mt-10 sm:mt-0 transform transition-all duration-300 hover:scale-105">
                    <dt class="order-2 mt-2 text-lg leading-6 font-medium text-gray-500">Available VRAM</dt>
                    <dd class="order-1 text-5xl font-extrabold text-neurogrid-600 animate-pulse-slow" id="available-vram">
                        <span class="loading-spinner hidden">⟳</span>
                        <span class="stat-value">-</span>
                    </dd>
                </div>
            </dl>
        </div>
    </div>

    <!-- Task Submission Modal -->
    <div id="taskModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium text-gray-900">Submit AI Task</h3>
                    <button onclick="hideTaskSubmission()" class="text-gray-400 hover:text-gray-600">
                        <span class="sr-only">Close</span>
                        ✕
                    </button>
                </div>
                <div class="mt-6">
                    <form id="taskForm" onsubmit="submitTask(event)">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Model Type</label>
                            <select id="modelType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neurogrid-500" required>
                                <option value="">Select model...</option>
                                <option value="llama2">LLaMA 2 (Text Generation)</option>
                                <option value="stable-diffusion">Stable Diffusion (Image Generation)</option>
                                <option value="whisper">Whisper (Speech-to-Text)</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Input Data</label>
                            <textarea id="inputData" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neurogrid-500" rows="4" placeholder="Enter your input data..." required></textarea>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                            <select id="priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-neurogrid-500">
                                <option value="standard">Standard</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div class="flex gap-3">
                            <button type="submit" class="flex-1 bg-neurogrid-600 text-white py-2 px-4 rounded-md hover:bg-neurogrid-700 focus:outline-none focus:ring-2 focus:ring-neurogrid-500">
                                Submit Task
                            </button>
                            <button type="button" onclick="hideTaskSubmission()" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-500">
                                Cancel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Tasks Section -->
    <div class="bg-gray-50">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Recent Tasks</h2>
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <ul id="tasksList" class="divide-y divide-gray-200">
                        <!-- Tasks will be populated here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Nodes Section -->
    <div class="bg-white">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">Active Nodes</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="nodesList">
                    <!-- Nodes will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800">
        <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex justify-center items-center mb-4">
                    <div class="w-8 h-8 bg-neurogrid-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">NG</span>
                    </div>
                    <span class="ml-3 text-xl font-semibold text-white">NeuroGrid</span>
                </div>
                <p class="text-gray-400">
                    Democratizing AI, one GPU at a time.
                </p>
                <div class="mt-6 flex justify-center space-x-6">
                    <a href="#" class="text-gray-400 hover:text-gray-300">Documentation</a>
                    <a href="#" class="text-gray-400 hover:text-gray-300">GitHub</a>
                    <a href="#" class="text-gray-400 hover:text-gray-300">Discord</a>
                    <a href="support.html" class="text-gray-400 hover:text-gray-300">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8080/api';
        
        // WebSocket connection
        let socket = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeUserSection();
            loadStats();
            loadRecentTasks();
            loadActiveNodes();
            connectWebSocket();
            
            // Refresh data every 30 seconds
            setInterval(() => {
                loadStats();
                loadRecentTasks();
                loadActiveNodes();
            }, 30000);
        });

        // Initialize user section
        function initializeUserSection() {
            const userSection = document.getElementById('userSection');
            const token = localStorage.getItem('authToken');

            if (token) {
                // User is logged in, show user menu
                userSection.innerHTML = `
                    <div class="relative">
                        <button id="userMenuButton" class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-neurogrid-500" onclick="toggleUserMenu()">
                            <div class="w-8 h-8 bg-neurogrid-100 rounded-full flex items-center justify-center mr-2">
                                <i class="fas fa-user text-neurogrid-600"></i>
                            </div>
                            <span class="text-gray-700 font-medium" id="userDisplayName">Пользователь</span>
                            <i class="fas fa-chevron-down ml-2 text-gray-400"></i>
                        </button>
                        <div id="userDropdown" class="hidden origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50">
                            <div class="py-1">
                                <a href="dashboard.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-tachometer-alt mr-2"></i>Дашборд
                                </a>
                                <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-user-circle mr-2"></i>Профиль
                                </a>
                                <a href="wallet.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-wallet mr-2"></i>Кошелек
                                </a>
                                <div class="border-t border-gray-200"></div>
                                <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Выйти
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                // Load user info
                loadUserInfo();
            } else {
                // User is not logged in, show login/register buttons
                userSection.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <button onclick="showLoginModal()" class="text-gray-600 hover:text-gray-900 px-3 py-2 text-sm font-medium">
                            Войти
                        </button>
                        <button onclick="showRegisterModal()" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-300">
                            Регистрация
                        </button>
                    </div>
                `;
            }
        }

        // Load user info
        async function loadUserInfo() {
            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    const displayName = data.data.displayName || data.data.email.split('@')[0];
                    document.getElementById('userDisplayName').textContent = displayName;
                }
            } catch (error) {
                console.error('Error loading user info:', error);
            }
        }

        // Toggle user menu
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenuButton = document.getElementById('userMenuButton');
            const userDropdown = document.getElementById('userDropdown');
            
            if (userMenuButton && userDropdown && 
                !userMenuButton.contains(event.target) && 
                !userDropdown.contains(event.target)) {
                userDropdown.classList.add('hidden');
            }
        });

        // Show login modal
        function showLoginModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl max-w-md w-full">
                    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Вход в систему</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <form onsubmit="handleLogin(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="loginEmail" class="w-full border border-gray-300 rounded-lg px-4 py-3" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Пароль</label>
                                    <input type="password" id="loginPassword" class="w-full border border-gray-300 rounded-lg px-4 py-3" required>
                                </div>
                            </div>
                            <div class="mt-6 flex space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-400 transition-colors">
                                    Отмена
                                </button>
                                <button type="submit" class="flex-1 bg-neurogrid-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-neurogrid-700 transition-colors">
                                    Войти
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Show register modal
        function showRegisterModal() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 z-50 bg-gray-500 bg-opacity-75 flex items-center justify-center p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl shadow-xl max-w-md w-full">
                    <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-lg font-semibold text-gray-900">Регистрация</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <form onsubmit="handleRegister(event)">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="registerEmail" class="w-full border border-gray-300 rounded-lg px-4 py-3" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Пароль</label>
                                    <input type="password" id="registerPassword" class="w-full border border-gray-300 rounded-lg px-4 py-3" required minlength="8">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Подтвердите пароль</label>
                                    <input type="password" id="registerConfirmPassword" class="w-full border border-gray-300 rounded-lg px-4 py-3" required minlength="8">
                                </div>
                            </div>
                            <div class="mt-6 flex space-x-3">
                                <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-400 transition-colors">
                                    Отмена
                                </button>
                                <button type="submit" class="flex-1 bg-neurogrid-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-neurogrid-700 transition-colors">
                                    Регистрация
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Handle login
        async function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('authToken', data.data.accessToken);
                    
                    // Close modal and refresh user section
                    document.querySelector('.fixed').remove();
                    initializeUserSection();
                    
                    showSuccessToast('Вход выполнен успешно!');
                } else {
                    const error = await response.json();
                    showErrorToast('Ошибка входа', error.error || 'Неверные учетные данные');
                }
            } catch (error) {
                showErrorToast('Ошибка подключения', 'Проверьте соединение с сервером');
            }
        }

        // Handle register
        async function handleRegister(event) {
            event.preventDefault();
            
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;

            if (password !== confirmPassword) {
                showErrorToast('Ошибка валидации', 'Пароли не совпадают');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('authToken', data.data.accessToken);
                    
                    // Close modal and refresh user section
                    document.querySelector('.fixed').remove();
                    initializeUserSection();
                    
                    showSuccessToast('Регистрация выполнена успешно!');
                } else {
                    const error = await response.json();
                    showErrorToast('Ошибка регистрации', error.error || 'Неудалось создать аккаунт');
                }
            } catch (error) {
                showErrorToast('Ошибка подключения', 'Проверьте соединение с сервером');
            }
        }

        // Logout
        function logout() {
            localStorage.removeItem('authToken');
            initializeUserSection();
            showSuccessToast('Вы вышли из системы');
        }

        // Show notification banner
        function showNotificationBanner(message, type = 'info') {
            const banner = document.createElement('div');
            const typeClasses = {
                'success': 'bg-green-500',
                'error': 'bg-red-500',
                'warning': 'bg-yellow-500',
                'info': 'bg-blue-500'
            };
            
            banner.className = `fixed top-4 right-4 z-50 ${typeClasses[type]} text-white px-6 py-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
            banner.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // Animate in
            setTimeout(() => {
                banner.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                banner.classList.add('translate-x-full');
                setTimeout(() => {
                    if (banner.parentElement) {
                        banner.remove();
                    }
                }, 300);
            }, 5000);
        }
        
        // WebSocket connection
        function connectWebSocket() {
            try {
                socket = new WebSocket('ws://localhost:3001/ws');
                
                socket.onopen = function() {
                    console.log('WebSocket connected');
                };
                
                socket.onmessage = function(event) {
                    const data = JSON.parse(event.data);
                    handleWebSocketMessage(data);
                };
                
                socket.onclose = function() {
                    console.log('WebSocket disconnected');
                    // Reconnect after 5 seconds
                    setTimeout(connectWebSocket, 5000);
                };
            } catch (error) {
                console.error('WebSocket connection failed:', error);
            }
        }
        
        function handleWebSocketMessage(data) {
            if (data.type === 'task_update') {
                updateTaskInList(data.payload);
            } else if (data.type === 'node_update') {
                updateNodeInList(data.payload);
            } else if (data.type === 'stats_update') {
                updateStats(data.payload);
            }
        }
        
        // Load network statistics
        async function loadStats() {
            // Show loading indicators
            showLoadingSpinners(['active-nodes', 'tasks-completed', 'available-vram']);
            
            try {
                const response = await fetch(`${API_BASE_URL}/nodes/stats`);
                const data = await response.json();
                
                if (data.success) {
                    updateStats(data.data);
                } else {
                    throw new Error('API returned success: false');
                }
            } catch (error) {
                console.error('Failed to load stats:', error);
                // Set fallback values
                updateStats({
                    activeNodes: 0,
                    totalTasks: 0,
                    totalNodes: 0,
                    completedTasks: 0,
                    networkUtilization: 0
                });
            } finally {
                hideLoadingSpinners(['active-nodes', 'tasks-completed', 'available-vram']);
            }
        }
        
        function updateStats(stats) {
            // Animate counter updates
            animateCounterUpdate('active-nodes', stats.activeNodes || 0);
            animateCounterUpdate('tasks-completed', stats.completedTasks || 0);
            animateVRAMUpdate('available-vram', stats.totalNodes * 24 || 0); // Assuming 24GB per node
        }
        
        function animateCounterUpdate(elementId, newValue) {
            const element = document.getElementById(elementId);
            const statValue = element.querySelector('.stat-value');
            const currentValue = parseInt(statValue.textContent) || 0;
            
            // Simple animation for number changes
            if (currentValue !== newValue) {
                statValue.style.transform = 'scale(1.1)';
                statValue.style.transition = 'transform 0.3s ease';
                
                setTimeout(() => {
                    statValue.textContent = newValue.toLocaleString();
                    statValue.style.transform = 'scale(1)';
                }, 150);
            }
        }
        
        function animateVRAMUpdate(elementId, totalGB) {
            const element = document.getElementById(elementId);
            const statValue = element.querySelector('.stat-value');
            
            statValue.style.transform = 'scale(1.1)';
            statValue.style.transition = 'transform 0.3s ease';
            
            setTimeout(() => {
                statValue.textContent = `${Math.round(totalGB)} GB`;
                statValue.style.transform = 'scale(1)';
            }, 150);
        }
        
        // Load recent tasks
        async function loadRecentTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/tasks?limit=10`);
                const data = await response.json();
                
                if (data.success) {
                    displayTasks(data.tasks);
                }
            } catch (error) {
                console.error('Failed to load tasks:', error);
                displayTasks([]);
            }
        }
        
        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = `
                    <li class="px-6 py-4 text-center text-gray-500">
                        No recent tasks found. Submit your first task to get started!
                    </li>
                `;
                return;
            }
            
            tasksList.innerHTML = tasks.map(task => `
                <li class="px-6 py-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <div class="w-10 h-10 rounded-full bg-neurogrid-100 flex items-center justify-center">
                                    <span class="text-neurogrid-600 font-medium text-sm">${task.model.charAt(0).toUpperCase()}</span>
                                </div>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-900">${task.model}</p>
                                <p class="text-sm text-gray-500">ID: ${task.id.substring(0, 8)}...</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusBadgeClass(task.status)}">
                                ${task.status}
                            </span>
                            <span class="ml-4 text-sm text-gray-500">
                                ${formatDate(task.created_at)}
                            </span>
                        </div>
                    </div>
                </li>
            `).join('');
        }
        
        // Load active nodes
        async function loadActiveNodes() {
            try {
                const response = await fetch(`${API_BASE_URL}/nodes?status=active&limit=6`);
                const data = await response.json();
                
                if (data.success) {
                    displayNodes(data.nodes);
                }
            } catch (error) {
                console.error('Failed to load nodes:', error);
                displayNodes([]);
            }
        }
        
        function displayNodes(nodes) {
            const nodesList = document.getElementById('nodesList');
            
            if (nodes.length === 0) {
                nodesList.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        No active nodes found. Be the first to join the network!
                    </div>
                `;
                return;
            }
            
            nodesList.innerHTML = nodes.map(node => `
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-900">Node ${node.id.substring(0, 8)}</h3>
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${getNodeStatusClass(node.status)}">
                            ${node.status}
                        </span>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">VRAM:</span>
                            <span class="font-medium">${node.max_vram_gb}GB</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">CPU Cores:</span>
                            <span class="font-medium">${node.max_cpu_cores}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Rating:</span>
                            <span class="font-medium">${(node.rating * 100).toFixed(0)}%</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-500">Tasks:</span>
                            <span class="font-medium">${node.tasks_completed || 0}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        // Task submission
        function showTaskSubmission() {
            document.getElementById('taskModal').classList.remove('hidden');
        }
        
        function hideTaskSubmission() {
            document.getElementById('taskModal').classList.add('hidden');
            document.getElementById('taskForm').reset();
        }
        
        async function submitTask(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const taskData = {
                model: document.getElementById('modelType').value,
                input: document.getElementById('inputData').value,
                priority: document.getElementById('priority').value
            };
            
            try {
                const response = await fetch(`${API_BASE_URL}/tasks`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(taskData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`Task submitted successfully! Task ID: ${result.task.id}`);
                    hideTaskSubmission();
                    loadRecentTasks(); // Refresh task list
                } else {
                    alert(`Failed to submit task: ${result.error}`);
                }
            } catch (error) {
                console.error('Task submission error:', error);
                alert('Failed to submit task. Please try again.');
            }
        }
        
        // Utility functions
        function getStatusBadgeClass(status) {
            const classes = {
                'pending': 'bg-yellow-100 text-yellow-800',
                'assigned': 'bg-blue-100 text-blue-800',
                'running': 'bg-blue-100 text-blue-800',
                'completed': 'bg-green-100 text-green-800',
                'failed': 'bg-red-100 text-red-800',
                'cancelled': 'bg-gray-100 text-gray-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }
        
        function getNodeStatusClass(status) {
            const classes = {
                'active': 'bg-green-100 text-green-800',
                'busy': 'bg-blue-100 text-blue-800',
                'offline': 'bg-gray-100 text-gray-800',
                'maintenance': 'bg-yellow-100 text-yellow-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffMins < 1440) return `${Math.floor(diffMins / 60)}h ago`;
            return date.toLocaleDateString();
        }
        
        function showNodeGuide() {
            alert('Node setup guide:\n\n1. Install the NeuroGrid client\n2. Configure your system\n3. Register with the network\n4. Start earning tokens!\n\nVisit our documentation for detailed instructions.');
        }
        
        function updateTaskInList(taskData) {
            // Update specific task in the list
            loadRecentTasks(); // For now, just reload the list
        }
        
        function updateNodeInList(nodeData) {
            // Update specific node in the list
            loadActiveNodes(); // For now, just reload the list
        }
        
        // Utility functions for loading indicators
        function showLoadingSpinners(elementIds) {
            elementIds.forEach(id => {
                const element = document.getElementById(id);
                const spinner = element.querySelector('.loading-spinner');
                const value = element.querySelector('.stat-value');
                if (spinner && value) {
                    spinner.classList.remove('hidden');
                    value.style.opacity = '0.5';
                }
            });
        }
        
        function hideLoadingSpinners(elementIds) {
            elementIds.forEach(id => {
                const element = document.getElementById(id);
                const spinner = element.querySelector('.loading-spinner');
                const value = element.querySelector('.stat-value');
                if (spinner && value) {
                    spinner.classList.add('hidden');
                    value.style.opacity = '1';
                }
            });
        }
        
        // Enhanced error handling with user-friendly messages
        function showErrorToast(message, details = '') {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up';
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-medium">${message}</div>
                        ${details ? `<div class="text-sm opacity-90 mt-1">${details}</div>` : ''}
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        ×
                    </button>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        function showSuccessToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up';
            toast.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="font-medium">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        ×
                    </button>
                </div>
            `;
            document.body.appendChild(toast);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }
    </script>
</body>
</html>