-- Migration: Enhanced Tasks Table\n-- Created: 2024-12-18T10:00:00.000Z\n-- Adds advanced fields for task management\n\n-- Create enhanced tasks table with additional fields\nCREATE TABLE IF NOT EXISTS enhanced_tasks (\n    id SERIAL PRIMARY KEY,\n    task_id VARCHAR(255) UNIQUE NOT NULL,\n    user_id INTEGER,\n    type VARCHAR(100) NOT NULL DEFAULT 'text-generation',\n    input_text TEXT NOT NULL,\n    input_hash VARCHAR(64) NOT NULL, -- For caching\n    model VARCHAR(100),\n    priority INTEGER DEFAULT 5,\n    status VARCHAR(50) DEFAULT 'pending',\n    result TEXT,\n    error_message TEXT,\n    processing_time INTEGER, -- milliseconds\n    cost DECIMAL(10, 6) DEFAULT 0,\n    cached BOOLEAN DEFAULT FALSE,\n    metadata JSONB,\n    \n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    started_at TIMESTAMP,\n    completed_at TIMESTAMP,\n    failed_at TIMESTAMP,\n    \n    -- Performance indexes\n    INDEX idx_task_id (task_id),\n    INDEX idx_user_id (user_id),\n    INDEX idx_status (status),\n    INDEX idx_input_hash (input_hash),\n    INDEX idx_created_at (created_at)\n);\n\n-- Create task statistics table for analytics\nCREATE TABLE IF NOT EXISTS task_statistics (\n    id SERIAL PRIMARY KEY,\n    date DATE NOT NULL,\n    total_tasks INTEGER DEFAULT 0,\n    completed_tasks INTEGER DEFAULT 0,\n    failed_tasks INTEGER DEFAULT 0,\n    avg_processing_time INTEGER, -- milliseconds\n    total_cost DECIMAL(10, 6) DEFAULT 0,\n    cache_hit_rate DECIMAL(5, 2) DEFAULT 0,\n    \n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    \n    UNIQUE(date)\n);\n\n-- Create user quotas table\nCREATE TABLE IF NOT EXISTS user_quotas (\n    id SERIAL PRIMARY KEY,\n    user_id INTEGER NOT NULL,\n    tier VARCHAR(20) DEFAULT 'free', -- free, pro, enterprise\n    requests_limit INTEGER DEFAULT 100,\n    requests_used INTEGER DEFAULT 0,\n    reset_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP + INTERVAL '1 month',\n    \n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    \n    UNIQUE(user_id)\n);