/**\n * Migration: WebSocket Connections Tracking\n * Created: 2024-12-18T10:15:00.000Z\n */\n\nmodule.exports = { \n    async up(client) { \n        // Create WebSocket connections tracking table\n        await client.query(`\n            CREATE TABLE IF NOT EXISTS websocket_connections (\n                id SERIAL PRIMARY KEY,\n                connection_id VARCHAR(255) UNIQUE NOT NULL,\n                user_id INTEGER,\n                ip_address INET,\n                user_agent TEXT,\n                subscriptions JSONB DEFAULT '[]',\n                \n                connected_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                disconnected_at TIMESTAMP,\n                last_activity TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                \n                INDEX idx_connection_id (connection_id),\n                INDEX idx_user_id (user_id),\n                INDEX idx_connected_at (connected_at)\n            )\n        `);\n        \n        // Create WebSocket events log table\n        await client.query(`\n            CREATE TABLE IF NOT EXISTS websocket_events (\n                id SERIAL PRIMARY KEY,\n                connection_id VARCHAR(255) NOT NULL,\n                event_type VARCHAR(50) NOT NULL,\n                event_data JSONB,\n                \n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                \n                INDEX idx_connection_id (connection_id),\n                INDEX idx_event_type (event_type),\n                INDEX idx_created_at (created_at)\n            )\n        `);\n        \n        // Create rate limiting logs table\n        await client.query(`\n            CREATE TABLE IF NOT EXISTS rate_limit_logs (\n                id SERIAL PRIMARY KEY,\n                user_id INTEGER,\n                ip_address INET,\n                endpoint VARCHAR(255),\n                tier VARCHAR(20),\n                requests_count INTEGER DEFAULT 1,\n                blocked BOOLEAN DEFAULT FALSE,\n                \n                window_start TIMESTAMP NOT NULL,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                \n                INDEX idx_user_id (user_id),\n                INDEX idx_ip_address (ip_address),\n                INDEX idx_endpoint (endpoint),\n                INDEX idx_window_start (window_start)\n            )\n        `);\n        \n        console.log('✅ WebSocket and rate limiting tables created');\n    },\n\n    async down(client) {\n        // Rollback WebSocket and rate limiting tables\n        await client.query('DROP TABLE IF EXISTS rate_limit_logs');\n        await client.query('DROP TABLE IF EXISTS websocket_events');\n        await client.query('DROP TABLE IF EXISTS websocket_connections');\n        \n        console.log('✅ WebSocket and rate limiting tables dropped');\n    }\n};