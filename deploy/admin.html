<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroGrid Admin - Beta Signups</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .refresh-btn { transition: transform 0.3s ease; }
        .refresh-btn:hover { transform: rotate(180deg); }
        .signup-card { transition: all 0.3s ease; }
        .signup-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-gray-900">NeuroGrid Admin</h1>
                    <span class="ml-4 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">Beta Signups</span>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="refreshData()" class="refresh-btn text-gray-600 hover:text-gray-900">
                        <i class="fas fa-sync-alt text-lg"></i>
                    </button>
                    <a href="/" class="text-blue-600 hover:text-blue-800 font-medium">‚Üê Back to Site</a>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Stats Overview -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-blue-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Total Signups</p>
                        <p class="text-2xl font-bold text-gray-900" id="totalSignups">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-calendar-day text-green-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Today</p>
                        <p class="text-2xl font-bold text-gray-900" id="todaySignups">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">This Week</p>
                        <p class="text-2xl font-bold text-gray-900" id="weekSignups">-</p>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-lg shadow p-6">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clock text-yellow-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-gray-600">Last Updated</p>
                        <p class="text-sm font-medium text-gray-900" id="lastUpdate">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Access Key Input -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <div class="flex items-center space-x-4">
                <div class="flex-1">
                    <label for="accessKey" class="block text-sm font-medium text-gray-700 mb-2">Admin Access Key</label>
                    <input type="password" id="accessKey" placeholder="Enter admin access key" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button onclick="loadSignups()" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-medium">
                    Load Data
                </button>
            </div>
        </div>

        <!-- Signups List -->
        <div class="bg-white rounded-lg shadow">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">Beta Signups</h2>
            </div>
            
            <div id="loadingState" class="p-8 text-center">
                <div class="text-gray-500">
                    <i class="fas fa-lock text-3xl mb-4"></i>
                    <p>Enter admin access key to view signups</p>
                </div>
            </div>
            
            <div id="signupsList" class="hidden">
                <!-- Signups will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        let signupsData = [];

        async function loadSignups() {
            const accessKey = document.getElementById('accessKey').value;
            if (!accessKey) {
                alert('Please enter access key');
                return;
            }

            try {
                const response = await fetch(`/admin/stats?key=${encodeURIComponent(accessKey)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                signupsData = data.data.beta_signups || [];
                
                updateStats();
                renderSignups();
                
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('signupsList').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error loading signups:', error);
                alert('Error loading data: ' + error.message);
            }
        }

        function updateStats() {
            const total = signupsData.length;
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString();
            
            const todayCount = signupsData.filter(s => s.timestamp.startsWith(today)).length;
            const weekCount = signupsData.filter(s => s.timestamp >= weekAgo).length;
            
            document.getElementById('totalSignups').textContent = total;
            document.getElementById('todaySignups').textContent = todayCount;
            document.getElementById('weekSignups').textContent = weekCount;
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }

        function renderSignups() {
            const container = document.getElementById('signupsList');
            
            if (signupsData.length === 0) {
                container.innerHTML = `
                    <div class="p-8 text-center text-gray-500">
                        <i class="fas fa-inbox text-3xl mb-4"></i>
                        <p>No beta signups yet</p>
                    </div>
                `;
                return;
            }

            const sortedSignups = signupsData.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = sortedSignups.map(signup => `
                <div class="signup-card p-6 border-b border-gray-200 hover:bg-gray-50">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <div class="flex items-center space-x-4">
                                <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-user text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900">${signup.email}</p>
                                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                                        <span><i class="fas fa-tag mr-1"></i>${signup.type}</span>
                                        <span><i class="fas fa-external-link-alt mr-1"></i>${signup.source}</span>
                                        <span><i class="fas fa-clock mr-1"></i>${new Date(signup.timestamp).toLocaleString()}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                                ${signup.status}
                            </span>
                            <button onclick="copyEmail('${signup.email}')" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function copyEmail(email) {
            navigator.clipboard.writeText(email).then(() => {
                // Simple feedback - could be improved with a toast
                const button = event.target;
                const originalClass = button.className;
                button.className = button.className.replace('fa-copy', 'fa-check');
                button.style.color = 'green';
                
                setTimeout(() => {
                    button.className = originalClass;
                    button.style.color = '';
                }, 1000);
            });
        }

        function refreshData() {
            loadSignups();
        }

        // Auto-refresh every 30 seconds
        setInterval(refreshData, 30000);
    </script>
</body>
</html>