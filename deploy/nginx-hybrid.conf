# NeuroGrid - Hybrid Production Configuration
# Preserves existing port 8080 setup + adds subdomains for production

# Rate limiting for production subdomains
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=100r/m;
limit_req_zone $binary_remote_addr zone=app_limit:10m rate=200r/m;

# Upstream servers for production subdomains
upstream api_backend {
    server 127.0.0.1:3001;
    keepalive 32;
}

upstream app_backend {
    server 127.0.0.1:3000;
    keepalive 32;
}

# EXISTING: Main neurogrid.network - proxy to port 8080 (PRESERVED!)
server {
    listen 80;
    server_name neurogrid.network www.neurogrid.network;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}

# NEW: API subdomain - api.neurogrid.network (–í–†–ï–ú–ï–ù–ù–û - Coming Soon)
server {
    listen 80;
    server_name api.neurogrid.network;
    
    # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–æ –¥–µ–ø–ª–æ—è API
    location / {
        return 200 '{"status": "coming_soon", "message": "NeuroGrid API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è", "version": "1.0.0"}';
        add_header Content-Type application/json;
    }
    
    location /health {
        return 200 '{"status": "ok", "message": "API placeholder"}';
        add_header Content-Type application/json;
    }
}

# NEW: App subdomain - app.neurogrid.network (–í–†–ï–ú–ï–ù–ù–û - Coming Soon)
server {
    listen 80;
    server_name app.neurogrid.network;
    
    # –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–æ –¥–µ–ø–ª–æ—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    location / {
        return 200 '<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroGrid App - Coming Soon</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            text-align: center; 
            padding: 100px 20px;
            margin: 0;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { font-size: 3rem; margin-bottom: 1rem; }
        p { font-size: 1.2rem; margin-bottom: 2rem; }
        .btn { 
            display: inline-block;
            padding: 15px 30px; 
            background: #ff6b6b; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ NeuroGrid App</h1>
        <p>–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ!</p>
        <p>–ü–æ–∫–∞ —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.</p>
        <a href="http://neurogrid.network" class="btn">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</body>
</html>';
        add_header Content-Type text/html;
    }
}

# HTTP to HTTPS redirect for subdomains only (when SSL is ready)
# Uncomment when SSL certificates are installed:
# server {
#     listen 80;
#     server_name api.neurogrid.network app.neurogrid.network;
#     return 301 https://$host$request_uri;
# }